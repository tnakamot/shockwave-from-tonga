# Visualization of Shockwave from Hunga Tonga

The animations below show the shockwaves generated by the massive volcanic eruption in Tonga.

## Japan

The animations below show time derivative of barometric pressure in Japan. Data were were obtained from [Japan Meteorological Agency](https://www.data.jma.go.jp/obd/stats/etrn/index.php).

https://user-images.githubusercontent.com/3995187/151719525-c729a0ee-744c-4b64-a27c-e30ac662c9ea.mp4

https://user-images.githubusercontent.com/3995187/151719534-26b6394b-bdd7-4ab5-af28-041a8ef6126b.mp4

https://user-images.githubusercontent.com/3995187/151719547-dec47392-8883-4b6c-a894-e567afe70005.mp4

The above animations clearly show that the shockwave from Hunga Tonga ([20°32'09.6"S 175°22'55.2"W](https://geohack.toolforge.org/geohack.php?params=20.536_S_175.382_W)). The first wave is the one that came from Hunga Tonga directly. The second wave is the one that passed through the antipode of Hunga Tonga ([20°32'09.6"N 4°37'4.8"E, somewhere in South Africa](https://geohack.toolforge.org/geohack.php?params=20.536_N_4.618_E)). And then, the third wave is the one that went around the globe all the way and came from Tonga again. Approximate arrival time at Kyoto of those three waves were:

 * First: January 15, 2022, 08:30 PM (JST)
    * This is about 7 hours and 15 minutes later than [the event of the eruption of Hunga Tonga](https://en.wikipedia.org/wiki/2022_Hunga_Tonga_eruption_and_tsunami). Kyoto is approximately 8,000 km away from Hunga Tonga. This means that the shockwave was propagated at a speed of about 307 m/s, which is slighly slower than the speed of sound at 15 deg C and 1 atm (340 m/s).
 * Second: January 16, 2022, 05:20 PM (JST)
    * This is about 28 hours since the eruption. The circumference of the Earth is about 40,000 km, so this wave should have traveled approximately (40,000 - 8,000) = 32,000 km. This indicates that the propagation speed was about 317 m/s.
 * Third: January 17, 2022, 09:00 AM (JST)
    * This is about about 1 and half days after the first wave. Because the circumference of the Eeath is about 40,000 km, we can calculate that the speed of this shockwave is about 309 m/s. This result is almost consistent with the above calculations.

## US

The animations below show time derivative of barometric pressure in United States. They are based on one-minute barometric pressure data of [US Automated Surface Observing System (ASOS)](https://www.ncei.noaa.gov/products/land-based-station/automated-surface-weather-observing-systems) (approximately 900 sites). The data were obtained from [Iowa Environmental Mesonet](https://mesonet.agron.iastate.edu/request/asos/1min.phtml) of [Iowa State University](https://www.iastate.edu/).

https://user-images.githubusercontent.com/3995187/151719789-efaed15e-a498-4945-9e55-c871d0de871b.mp4

https://user-images.githubusercontent.com/3995187/151719795-59948400-6674-4894-8086-1d5a3fa01c36.mp4

## Wavefront Simulation

The animations below shows simulated wavefronts of the shockwave from Hunga Tonga assuming the propagation speeds of 300, 305, 310, 315, and 320 m/s.

https://user-images.githubusercontent.com/3995187/151721391-5f67805b-d132-492c-9644-b00462159e4e.mp4

https://user-images.githubusercontent.com/3995187/151721398-5dffaf4c-e6ca-4727-b46c-ea50ddb6ce75.mp4

## How To

If you want to reproduce the same animations above, follow the instructions below.

### Prerequisite

You need the following software packages on your machine:

 * Python 3.8
 * OpenCV 4.2.0 and its python binding
 
In addition, you need the following python modules.

 * tqdm 4.30.0
 * BeautifulSoup 4.8.2
 * numpy 1.17.4
 * matplotlib 3.1.2
 * cartopy 0.17.0
 * geopy 1.20.0
 * scipy 1.3.3
 * Pillow 9.0.0

The versions indicated above are the ones that the author is using. You may use other versions.
 
On Ubuntu 20.04, you can install the above software packages except Pillow through the `apt` command:

```
 $ sudo apt install python3 python3-opencv python3-tqdm python3-bs4 python3-numpy python3-matplotlib python3-cartopy python3-geopy python3-scipy
```

Then, you need to install Pillow with the commands below:

```
 $ sudo apt install python3-pip
 $ python3 -m pip install -U Pillow
```

### Download barometric pressure data

Once you have all required software packages, go to the root directory of this git repository and run the commands below to download pressure data from various data sources:

```
 $ python3 -m analyze.import_data jma
 $ python3 -m analyze.import_data asos1min
```

The first command downloads barometric pressure data from [Japan Meteorological Agency](https://www.data.jma.go.jp/obd/stats/etrn/index.php), and the second one downloads barometric pressure data of [US Automated Surface Observing System (ASOS)](https://www.ncei.noaa.gov/products/land-based-station/automated-surface-weather-observing-systems) through [Iowa Environmental Mesonet](https://mesonet.agron.iastate.edu/request/asos/1min.phtml) of [Iowa State University](https://www.iastate.edu/).

These commands may take about an hour in total, so be patient.

The downloaded data will be saved in `database.sqlite3` in the same directory. The size of this database file can be more than 1 GB.

### Generate animations

To reproduce the animations of the time derivative of barometric pressure, run the command below

```
 $ python3 -m analyze.generate_local_map_animation jma 1 --scale 0.4
 $ python3 -m analyze.generate_local_map_animation jma 2 --scale 0.1
 $ python3 -m analyze.generate_local_map_animation jma 3 --scale 0.15
 $ python3 -m analyze.generate_local_map_animation asos1min 1 --scale 0.4
 $ python3 -m analyze.generate_local_map_animation asos1min 2 --scale 0.4
```

The animation GIFs and equivalent MP4 videos will be saved in `output/` directory. There are various options for this command to customize the animation. Run the command below to see what options are available.

```
 $ python3 -m analyze.generate_local_map_animation --help
```

### Wavefront simulation

Run the command below to reproduce the animation of the simulated wavefront:

```
 $ python3 -m analyze.simulate_wavefront
 $ python3 -m analyze.simulate_wavefront --projection Orthographic --output output/wavefront_simulation_orthographic.mp4
```

The first command generates `output/wavefront_simulation.mp4` where the calculated wavefronts are drawn in the map using the Plate Carree method. The second one generates `output/wavefront_simulation_orthographic.mp4` where the world map are drawn in Orthographic method.

There are various options for this command to customize the animation. Run the command below to see what options are available.

```
 $ python3 -m analyze.simulate_wavefront --help
```

### MP4 codec

The MP4 codec used by this script is not the best in terms of file size. To compress the MP4 file further, it is recommended to use H264 encoder. For example, if you are using Ubuntu 20.04, run the commands below to do so:

```
 $ sudo apt install x264
 $ x264 -o xxx_h264.mp4 xxx.mp4
```

### Calculation of distance

The programs in this repsitory use `geopy.distance.geodesic()` method to calculate the distance from Hunga Tonga to any points on the Earth. According to the [GeoPy's documentation](https://geopy.readthedocs.io/en/v1/#module-geopy.distance), it uses the method given by [Kerney (2013)](https://doi.org/10.1007%2Fs00190-012-0578-z) and [WGS-84](https://en.wikipedia.org/wiki/World_Geodetic_System) ellipsoidal model.

## Acknowledgement

Visualization of the time derivative of the barometric pressure to see the shockwave was originally done by Weathernews Inc.

 * [トンガでの火山噴火による衝撃波か日本各地で急激な気圧変化](https://weathernews.jp/s/topics/202201/150195/)
 * [トンガ火山噴火による衝撃波が地球1周して再来か　今朝も各地で気圧変化](https://weathernews.jp/s/topics/202201/170085/)

They have used their own measurement instruments while I am using data from public data sources.

## TODO

 * Write about how to visualize ASOS1MIN network data.

